!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((r=r||self).crud={})}(this,function(r){"use strict";function e(r){var e="function"==typeof Symbol&&r[Symbol.iterator],t=0;return e?e.call(r):{next:function(){return r&&t>=r.length&&(r=void 0),{value:r&&r[t++],done:!r}}}}function t(r,e){var t="function"==typeof Symbol&&r[Symbol.iterator];if(!t)return r;var n,o,i=t.call(r),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(r){o={error:r}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return a}function n(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(t(arguments[e]));return r}function o(r){var e=Object.prototype.toString.call(r).split(" ")[1];return e.slice(0,e.length-1).toLowerCase()}function i(r){return r.trim().split(" ").filter(function(r){return""!==r})}function a(r){var e=o(r);return"array"===e?r.every(function(r){return r instanceof Element}):"nodelist"===e||"htmlcollection"===e}function c(r){var e;if(r.includes("-=")){var t=r.indexOf("-=");e=[r.slice(0,t).trim(),r.slice(t+2).trim(),"-="]}else if(r.includes("+=")){t=r.indexOf("+=");e=[r.slice(0,t).trim(),r.slice(t+2).trim(),"+="]}else if(r.includes("=")){t=r.indexOf("=");e=[r.slice(0,t).trim(),r.slice(t+1).trim(),"="]}if(3!==e.length)throw new Error("options item not match key=val or key-=val or key+=val");return e}function l(r){var e=[];return Object.entries(r).map(function(r){r[0].endsWith("-")?e.push([r[0].slice(0,r[0].length-1),r[1],"-="]):r[0].endsWith("+")?e.push([r[0].slice(0,r[0].length-1),r[1],"+="]):e.push([r[0],r[1],"="])}),e}function u(r){var t,i,a=[];try{for(var u=e(r),f=u.next();!f.done;f=u.next()){var s=f.value;"string"==o(s)?a.push(c(s)):"object"==o(s)&&a.push.apply(a,n(l(s)))}}catch(r){t={error:r}}finally{try{f&&!f.done&&(i=u.return)&&i.call(u)}finally{if(t)throw t.error}}return a}var f={doms:{"+=":{beforeScript:!1}},debug:!1},s={};function d(){s.log=function(){},s.warn=function(){},s.error=function(){}}var y=new Proxy(f,{set:function(r,e,t){return"debug"==e&&(0==t?d():(s.log=function(r,e){console.log("%c[dom-crud:log][%s]\n %c%s","color:#18b7ff;background:rgba(0,0,0,0.02);padding:0.2rem",r,"background:rgba(0,0,0,0.02);padding:0.2rem",e)},s.warn=function(r,e){console.log("%c[dom-crud:warn][%s]\n %c%s","color:orange;background:rgba(0,0,0,0.02);padding:0.2rem",r,"background:rgba(0,0,0,0.02);padding:0.2rem",e)},s.error=function(r,e){console.log("%c[dom-crud:error][%s]\n %c%s","color:red;background:rgba(0,0,0,0.02);padding:0.2rem",r,"background:rgba(0,0,0,0.02);padding:0.2rem",e)})),r[e]=t,!0}});function m(r,t,n){var o,i,c,l,u,f;if(void 0===n&&(n=""),!a(t))throw new TypeError("when key is 'doms', value should be array/array-like and from one of Element[], HTMLCollection, NodeList");if(n&&"script"===n){var s=r.querySelector("script");try{for(var d=e(t),y=d.next();!y.done;y=d.next()){var m=y.value;r.insertBefore(m,s)}}catch(r){o={error:r}}finally{try{y&&!y.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}}else if(n&&n instanceof Element)try{for(var g=e(t),p=g.next();!p.done;p=g.next()){m=p.value;r.insertBefore(m,n)}}catch(r){c={error:r}}finally{try{p&&!p.done&&(l=g.return)&&l.call(g)}finally{if(c)throw c.error}}else try{for(var v=e(t),h=v.next();!h.done;h=v.next()){m=h.value;r.appendChild(m)}}catch(r){u={error:r}}finally{try{h&&!h.done&&(f=v.return)&&f.call(v)}finally{if(u)throw u.error}}}function g(r,e,t,n){"="==r&&e(),"+="==r&&t(),"-="==r&&n()}d(),r.cdom=function(r){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var a=document.createElement(r);return u(e).map(function(r){var e,o=t(r,2),c=o[0],l=o[1];switch(c){case"class":(e=a.classList).add.apply(e,n(i(l.toString())));break;case"style":a.style.cssText=l.toString();break;case"text":a.textContent=l.toString();break;case"html":a.innerHTML+=l.toString();break;case"doms":m(a,l);break;default:a.setAttribute(c,l.toString())}}),a},r.ddom=function(r){return r instanceof Element?(r.remove(),!0):(s.warn("ddom","you passed an invalid parameter(type is "+o(r)+"), ddom removed nothing"),!1)},r.getCrudConfig=function(){return JSON.parse(JSON.stringify(y))},r.rdom=function(r){var e=document.querySelector(r);return e?(e.rdom=e.querySelector,e):null},r.rdoms=function(r){return document.querySelectorAll(r)},r.udom=function(r){for(var o=[],c=1;c<arguments.length;c++)o[c-1]=arguments[c];return u(o).map(function(o){var c=t(o,3),l=c[0],u=c[1],d=c[2];switch(l){case"class":g(d,function(){var e;r.className="",(e=r.classList).add.apply(e,n(i(u.toString())))},function(){var e;(e=r.classList).add.apply(e,n(i(u.toString())))},function(){var e;(e=r.classList).remove.apply(e,n(i(u.toString())))});break;case"style":g(d,function(){r.style.cssText=u.toString()},function(){r.style.cssText+=u.toString()},function(){u.toString().split(";").map(function(e){r.style.removeProperty(e)})});break;case"text":g(d,function(){r.textContent=u.toString()},function(){r.textContent+=u.toString()},function(){r.textContent=""});break;case"html":g(d,function(){r.innerHTML=u.toString()},function(){r.innerHTML+=u.toString()},function(){r.innerHTML=""});break;case"doms":g(d,function(){r.innerHTML="",m(r,u)},function(){!function(r){if(r in f&&f.hasOwnProperty(r))return f[r];throw new Error(r+" not exists in global curd config")}("doms")["+="].beforeScript?m(r,u):m(r,u,"script")},function(){!function(r,t){var n,o;if(!a(t))throw new TypeError("when key is 'doms', value should be array/array-like and from one of Element[], HTMLCollection, NodeList");try{for(var i=e(t),c=i.next();!c.done;c=i.next()){var l=c.value;l.parentNode==r?l.remove():s.warn("_removeDoms","encountered a dom that is not a child dom, removing skipped")}}catch(r){n={error:r}}finally{try{c&&!c.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}}(r,u)});break;default:g(d,function(){r.setAttribute(l,u.toString())},function(){r.setAttribute(l,u.toString())},function(){r.removeAttribute(l)})}}),r},r.updateCrudConfig=function(r){var e=o(r);if("object"!==e)throw new TypeError("config should be an object, received type is "+e);!function r(e,t){var n=o(e),i=o(t);if("object"!==n||"object"!==i)throw new TypeError("target and source should both be object, received: target is "+n+", source is "+i);for(var a in t)if(t.hasOwnProperty(a)&&a in e){var c="object"==o(e[a]),l="object"==o(t[a]);l||c?c&&l&&r(e[a],t[a]):e[a]=t[a]}}(y,r)},Object.defineProperty(r,"__esModule",{value:!0})});
